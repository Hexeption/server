generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model AuthToken {
  userId    Int      @db.UnsignedInt
  selector  String   @db.Char(36)
  validator String   @db.Char(60)
  timestamp DateTime @default(now()) @db.Timestamp(0)
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@id([userId, selector])
  @@map("auth_tokens")
}

model Ban {
  id          Int      @id @default(autoincrement()) @db.UnsignedInt
  userId      Int      @db.UnsignedInt
  expires     DateTime @db.Timestamp(0)
  moderatorId Int?     @db.UnsignedInt
  message     String?  @db.VarChar(60)
  issued      DateTime @default(now()) @db.Timestamp(0)
  moderator   User?    @relation("ban_moderatorId", fields: [moderatorId], references: [id], onUpdate: SetNull)
  user        User     @relation("ban_userId", fields: [userId], references: [id], onDelete: Cascade)

  @@index([moderatorId])
  @@index([userId])
  @@map("bans")
}

model Buddy {
  userId  Int  @db.UnsignedInt
  buddyId Int  @db.UnsignedInt
  buddy   User @relation("buddy_buddyId", fields: [buddyId], references: [id], onDelete: Cascade)
  user    User @relation("buddy_userId", fields: [userId], references: [id], onDelete: Cascade)

  @@id([userId, buddyId])
  @@index([buddyId])
  @@map("buddies")
}

model FurnitureInventory {
  userId   Int  @db.UnsignedInt
  itemId   Int  @db.UnsignedInt
  quantity Int  @db.UnsignedInt
  user     User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@id([userId, itemId])
  @@map("furniture_inventories")
}

model Furniture {
  id          Int  @id @default(autoincrement()) @db.UnsignedInt
  userId      Int  @db.UnsignedInt
  furnitureId Int  @db.UnsignedInt
  x           Int  @default(0) @db.UnsignedSmallInt
  y           Int  @default(0) @db.UnsignedSmallInt
  rotation    Int  @default(1) @db.UnsignedSmallInt
  frame       Int  @default(1) @db.UnsignedSmallInt
  user        User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@map("furnitures")
}

model IglooInventory {
  userId  Int  @db.UnsignedInt
  iglooId Int  @db.UnsignedInt
  user    User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@id([userId, iglooId])
  @@map("igloo_inventories")
}

model Igloo {
  userId   Int     @id @db.UnsignedInt
  type     Int     @default(1) @db.UnsignedInt
  flooring Int     @default(0) @db.UnsignedInt
  music    Int     @default(0) @db.UnsignedInt
  location Int     @default(1) @db.UnsignedInt
  locked   Boolean @default(true)
  user     User    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("igloos")
}

model Ignore {
  userId      Int  @db.UnsignedInt
  ignoreId    Int  @db.UnsignedInt
  ignoredUser User @relation("ignore_ignoreId", fields: [ignoreId], references: [id], onDelete: Cascade)
  user        User @relation("ignore_userId", fields: [userId], references: [id], onDelete: Cascade)

  @@id([userId, ignoreId])
  @@index([ignoreId])
  @@map("ignores")
}

model Inventory {
  userId Int  @db.UnsignedInt
  itemId Int  @db.UnsignedInt
  user   User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@id([userId, itemId])
  @@map("inventories")
}

model User {
  id                    Int                  @id @default(autoincrement()) @db.UnsignedInt
  username              String               @unique @db.VarChar(12)
  email                 String?              @db.VarChar(254)
  password              String               @db.Char(60)
  loginKey              String?              @db.Text
  rank                  Int                  @default(0) @db.UnsignedTinyInt
  permaBan              Boolean              @default(false)
  joinTime              DateTime             @default(now()) @db.Timestamp(0)
  coins                 Int                  @default(500) @db.UnsignedInt
  head                  Int                  @default(0) @db.UnsignedInt
  face                  Int                  @default(0) @db.UnsignedInt
  neck                  Int                  @default(0) @db.UnsignedInt
  body                  Int                  @default(0) @db.UnsignedInt
  hand                  Int                  @default(0) @db.UnsignedInt
  feet                  Int                  @default(0) @db.UnsignedInt
  color                 Int                  @default(1) @db.UnsignedInt
  photo                 Int                  @default(0) @db.UnsignedInt
  flag                  Int                  @default(0) @db.UnsignedInt
  auth_tokens           AuthToken[]
  ban_moderatorId       Ban[]                @relation("ban_moderatorId")
  ban_userId            Ban[]                @relation("ban_userId")
  buddy_buddyId         Buddy[]              @relation("buddy_buddyId")
  buddy_userId          Buddy[]              @relation("buddy_userId")
  furniture_inventories FurnitureInventory[]
  furnitures            Furniture[]
  igloo_inventories     IglooInventory[]
  igloos                Igloo?
  ignore_ignoreId       Ignore[]             @relation("ignore_ignoreId")
  ignore_userId         Ignore[]             @relation("ignore_userId")
  inventories           Inventory[]

  @@map("users")
}

model World {
  id         String @id @db.VarChar(100)
  population Int    @default(0) @db.UnsignedSmallInt

  @@map("worlds")
}
