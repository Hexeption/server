generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model AuthToken {
  userId    Int
  selector  String   @db.Char(36)
  validator String   @db.Char(60)
  timestamp DateTime @default(now()) @db.Timestamp(0)
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@id([userId, selector])
  @@map(name: "auth_tokens")
}

model Ban {
  id          Int      @id @default(autoincrement())
  userId      Int
  issued      DateTime @default(now()) @db.Timestamp(0)
  expires     DateTime @default(dbgenerated("('0000-00-00 00:00:00')")) @db.Timestamp(0)
  moderatorId Int?
  message     String?  @db.VarChar(60)
  user        User     @relation("ban_userId", fields: [userId], references: [id], onDelete: Cascade)
  moderator   User?    @relation("ban_moderatorId", fields: [moderatorId], references: [id], onUpdate: SetNull)

  @@index([moderatorId])
  @@index([userId])
  @@map(name: "bans")
}

model Buddy {
  userId  Int
  buddyId Int
  user    User @relation("buddy_userId", fields: [userId], references: [id], onDelete: Cascade)
  buddy   User @relation("buddy_buddyId", fields: [buddyId], references: [id], onDelete: Cascade)

  @@id([userId, buddyId])
  @@index([buddyId])
  @@map(name: "buddies")
}

model FurnitureInventory {
  userId   Int
  itemId   Int
  quantity Int
  user     User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@id([userId, itemId])
  @@map(name: "furniture_inventories")
}

model Furniture {
  id          Int  @id @default(autoincrement())
  userId      Int
  furnitureId Int
  x           Int  @default(0) @db.SmallInt
  y           Int  @default(0) @db.SmallInt
  rotation    Int  @default(1) @db.SmallInt
  frame       Int  @default(1) @db.SmallInt
  user        User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@map(name: "furnitures")
}

model IglooInventory {
  userId  Int
  iglooId Int
  user    User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@id([userId, iglooId])
  @@map(name: "igloo_inventories")
}

model Igloo {
  userId   Int     @id
  type     Int     @default(1)
  flooring Int     @default(0)
  music    Int     @default(0)
  location Int     @default(1)
  locked   Boolean @default(true)
  user     User    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map(name: "igloos")
}

model Ignore {
  userId      Int
  ignoreId    Int
  user        User @relation("ignore_userId", fields: [userId], references: [id], onDelete: Cascade)
  ignoredUser User @relation("ignore_ignoreId", fields: [ignoreId], references: [id], onDelete: Cascade)

  @@id([userId, ignoreId])
  @@index([ignoreId])
  @@map(name: "ignores")
}

model Inventory {
  userId Int
  itemId Int
  user   User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@id([userId, itemId])
  @@map(name: "inventories")
}

model User {
  id                    Int                  @id @default(autoincrement())
  username              String               @unique(map: "username") @db.VarChar(12)
  email                 String?              @db.VarChar(254)
  password              String               @db.Char(60)
  loginKey              String?              @db.Text
  rank                  Int                  @default(0)
  permaBan              Boolean              @default(false)
  joinTime              DateTime             @default(now()) @db.Timestamp(0)
  coins                 Int                  @default(500)
  head                  Int                  @default(0)
  face                  Int                  @default(0)
  neck                  Int                  @default(0)
  body                  Int                  @default(0)
  hand                  Int                  @default(0)
  feet                  Int                  @default(0)
  color                 Int                  @default(1)
  photo                 Int                  @default(0)
  flag                  Int                  @default(0)
  auth_tokens           AuthToken[]
  furniture_inventories FurnitureInventory[]
  furnitures            Furniture[]
  igloo_inventories     IglooInventory[]
  igloos                Igloo?
  inventories           Inventory[]
  ban_userId            Ban[]                @relation("ban_userId")
  ban_moderatorId       Ban[]                @relation("ban_moderatorId")
  buddy_userId          Buddy[]              @relation("buddy_userId")
  buddy_buddyId         Buddy[]              @relation("buddy_buddyId")
  ignore_userId         Ignore[]             @relation("ignore_userId")
  ignore_ignoreId       Ignore[]             @relation("ignore_ignoreId")

  @@map(name: "users")
}

model World {
  id         String @id @db.VarChar(100)
  population Int    @default(0) @db.SmallInt

  @@map(name: "worlds")
}
